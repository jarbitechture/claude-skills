---
name: gastrointestinal
description: Gastrointestinal physiology - motility, secretion, digestion, absorption, and regulatory hormones
parent: quantitative-physiology
unit: 8
---

# Gastrointestinal Physiology

## Overview

This sub-skill covers the quantitative aspects of gastrointestinal function including motility, secretion, digestion, absorption, and hormonal regulation. The GI tract processes ~9 L/day of fluid (2 L ingested + 7 L secreted) with >98% reabsorption efficiency.

## Core Concepts

### 1. GI Motility

#### Smooth Muscle Electrical Activity

**Slow Waves** (basic electrical rhythm):
- Generated by interstitial cells of Cajal (ICC)
- Frequency varies by region:
  - Stomach: 3-4 cycles/min
  - Duodenum: 11-12 cycles/min
  - Ileum: 8-9 cycles/min
  - Colon: 2-6 cycles/min

**Slow wave equation** (simplified oscillator):
```
V(t) = V_rest + A × sin(2πft)
```
Where:
- V_rest = resting membrane potential (~-60 mV)
- A = amplitude of oscillation (~10-15 mV)
- f = frequency (Hz)

**Action potentials**: Spike bursts superimposed on slow waves when threshold reached
```
Contraction strength ∝ Number of action potentials per slow wave cycle
```

#### Peristalsis

**Propagation velocity**:
```
v = λ × f
```
Where λ = wavelength, f = contraction frequency

**Typical values**:
- Esophagus: 2-4 cm/s
- Small intestine: 0.5-2 cm/s
- Colon: 0.5-1 cm/s (mass movements faster: 5-10 cm/s)

**Law of the Intestine** (Bayliss and Starling):
- Distension → oral contraction + aboral relaxation
- Mediated by enteric nervous system

#### Transit Times

| Segment | Transit Time |
|---------|--------------|
| Esophagus | 4-8 seconds |
| Stomach | 2-6 hours |
| Small intestine | 3-5 hours |
| Colon | 12-36 hours |
| Total GI | 24-72 hours |

**Gastric emptying** (first-order kinetics for liquids):
```
V(t) = V₀ × e^(-k×t)
t₁/₂ = ln(2)/k ≈ 10-20 min (liquids)
```

For solids (lag phase + linear):
```
V(t) = V₀           for t < t_lag
V(t) = V₀ - r×(t - t_lag)   for t ≥ t_lag
```
Where r = emptying rate (~1-2 kcal/min)

#### Migrating Motor Complex (MMC)

**Phase characteristics**:
- Phase I: Quiescence (45-60 min)
- Phase II: Irregular contractions (30-45 min)
- Phase III: Intense regular contractions (5-15 min)
- Phase IV: Transition (brief)

**Cycle length**: ~90-120 min during fasting

### 2. GI Secretion

#### Salivary Secretion

**Daily volume**: ~1-1.5 L/day
**Flow rate range**: 0.1 mL/min (basal) to 4 mL/min (stimulated)

**Composition**:
- Hypotonic (compared to plasma)
- α-amylase (ptyalin): starch digestion
- Mucins: lubrication
- IgA: immune protection
- Lysozyme: antibacterial

**Ion modification** (two-stage hypothesis):
```
Primary secretion (isotonic): [Na⁺] ≈ [Cl⁻] ≈ 150 mM
Ductal modification: Na⁺ reabsorbed, K⁺ and HCO₃⁻ secreted

Final composition depends on flow rate:
High flow → closer to plasma (less time for modification)
Low flow → more hypotonic, higher [K⁺] and [HCO₃⁻]
```

#### Gastric Secretion

**Daily volume**: ~2-3 L/day
**H⁺ concentration**: Up to 150 mM (pH ≈ 0.8-1)

**Parietal cell H⁺ secretion**:
```
H₂O + CO₂ → H₂CO₃ → H⁺ + HCO₃⁻
H⁺ secreted via H⁺/K⁺-ATPase
HCO₃⁻ exchanged for Cl⁻ (alkaline tide)
```

**Maximal acid output (MAO)**:
```
MAO ≈ 20-25 mEq/h (normal)
```

**Basal acid output (BAO)**:
```
BAO ≈ 2-5 mEq/h
BAO/MAO ratio: normally < 0.4
```

**Regulation phases**:
1. Cephalic (30%): vagal stimulation → ACh → parietal cell
2. Gastric (60%): distension, amino acids → gastrin release
3. Intestinal (10%): amino acids → enterooxyntin

**Pepsin kinetics**:
```
Optimal pH: 1.8-3.5
Activity = A_max × [H⁺]^n / (K_H^n + [H⁺]^n)
```

#### Pancreatic Secretion

**Daily volume**: ~1-2 L/day
**HCO₃⁻ concentration**: Up to 140 mM (highest in body)

**Bicarbonate secretion** (ductal cells):
```
CO₂ + H₂O → H₂CO₃ → H⁺ + HCO₃⁻
HCO₃⁻ secreted via CFTR + Cl⁻/HCO₃⁻ exchanger
```

**Flow-composition relationship**:
```
At high flow: [HCO₃⁻] → 140 mM, [Cl⁻] → 20 mM
At low flow: [HCO₃⁻] → 20 mM, [Cl⁻] → 140 mM
Sum [HCO₃⁻] + [Cl⁻] ≈ constant ≈ 160 mM
```

**Enzyme secretion** (acinar cells):
- Proteases: trypsinogen, chymotrypsinogen, proelastase, procarboxypeptidases
- Amylase: active form
- Lipase, colipase, phospholipase A₂
- Nucleases: DNase, RNase

**Activation cascade**:
```
Enterokinase (brush border) → Trypsinogen → Trypsin
Trypsin → activates all other zymogens
```

#### Biliary Secretion

**Daily bile production**: ~500-1000 mL/day
**Gallbladder capacity**: ~30-50 mL (concentrates 5-20×)

**Bile acid pool**: ~2-4 g
**Enterohepatic circulation**: 6-10 cycles/day

**Bile acid synthesis rate**:
```
Synthesis ≈ Fecal loss ≈ 0.3-0.6 g/day
```

**Critical micellar concentration (CMC)**:
```
For bile salts: CMC ≈ 2-5 mM
Micelle formation requires [bile salt] > CMC
```

**Cholesterol solubility** (lithogenic index):
```
LI = Actual cholesterol / Maximum soluble cholesterol
LI > 1 → supersaturated → gallstone risk
```

### 3. Digestion

#### Carbohydrate Digestion

**Daily intake**: ~250-300 g/day
**Composition**: ~60% starch, 30% sucrose, 10% lactose

**α-Amylase kinetics** (salivary + pancreatic):
```
Starch → Maltose + Maltotriose + α-limit dextrins
J = J_max × [Starch] / (K_m + [Starch])
K_m ≈ 1-2 mg/mL
```

**Brush border disaccharidases**:
```
Maltase: Maltose → 2 Glucose
Sucrase: Sucrose → Glucose + Fructose
Lactase: Lactose → Glucose + Galactose
Isomaltase: α-1,6 bonds in limit dextrins
```

**Lactase activity**:
```
Adult lactase persistence: ~35% of world population
Lactase non-persistence: activity ↓ to 5-10% of infant levels
```

#### Protein Digestion

**Daily intake**: ~70-100 g/day + 35-200 g endogenous protein

**Pepsin** (stomach):
```
Optimal pH: 1.8-3.5
Cleaves: Phe, Tyr, Trp (aromatic amino acids)
Products: Large peptides
```

**Pancreatic proteases** (small intestine):
```
Trypsin: cleaves after Lys, Arg (basic)
Chymotrypsin: cleaves after Phe, Tyr, Trp (aromatic)
Elastase: cleaves after Ala, Gly, Ser (small neutral)
Carboxypeptidases A/B: remove C-terminal amino acids
```

**Brush border peptidases**:
```
Aminopeptidases: N-terminal
Di/tri-peptidases: oligopeptides → amino acids
```

**Absorption forms**:
```
~40% free amino acids
~60% di/tripeptides (via PepT1 transporter)
```

#### Lipid Digestion

**Daily intake**: ~80-100 g/day (mainly triglycerides)

**Emulsification**:
```
Surface area ∝ 1/droplet radius
Bile salts stabilize emulsion droplets (~1 μm diameter)
```

**Pancreatic lipase kinetics**:
```
TG + H₂O → 2 FFA + 2-monoglyceride
Requires colipase (anchors to emulsion surface)
J = J_max × [TG] / (K_m + [TG])
```

**Micelle structure**:
```
Core: fatty acids, monoglycerides, cholesterol
Surface: bile salts, phospholipids
Diameter: ~4-6 nm (diffuse through unstirred layer)
```

**Fat absorption efficiency**: >95% for typical diet

### 4. Absorption

#### Water and Electrolyte Absorption

**Daily fluid balance**:
```
Input:
  Ingested: ~2 L
  Salivary: 1.5 L
  Gastric: 2.5 L
  Bile: 0.5 L
  Pancreatic: 1.5 L
  Intestinal: 1 L
  Total: ~9 L

Output:
  Fecal: ~100-200 mL
  Absorbed: ~8.8 L (>98%)
```

**Absorption by segment**:
```
Small intestine: ~7-8 L/day
Colon: ~1-2 L/day (max capacity ~5-6 L/day)
```

**Sodium absorption mechanisms**:
1. Na⁺/glucose cotransport (SGLT1): electrogenic
2. Na⁺/amino acid cotransport: electrogenic
3. Na⁺/H⁺ exchange (NHE3): electroneutral
4. ENaC (colon): electrogenic, aldosterone-regulated

**SGLT1 stoichiometry**:
```
2 Na⁺ : 1 glucose : ~260 H₂O molecules
```

**Chloride absorption**:
```
Cl⁻/HCO₃⁻ exchange (coupled to Na⁺/H⁺ exchange)
Paracellular (follows Na⁺ gradient)
```

#### Nutrient Absorption

**Glucose/galactose**: SGLT1 (apical) → GLUT2 (basolateral)
```
J_glucose = J_max × [Glucose] / (K_m + [Glucose])
K_m (SGLT1) ≈ 0.3 mM
```

**Fructose**: GLUT5 (facilitated diffusion)
```
K_m (GLUT5) ≈ 6-11 mM
```

**Amino acids**: Multiple transporters
- Neutral amino acids: System B⁰ (Na⁺-dependent)
- Basic amino acids: System y⁺
- Acidic amino acids: System X⁻_AG

**Lipid absorption**:
```
Micelles → brush border → diffusion into enterocyte
Re-esterification in smooth ER
Chylomicron formation → lymphatic drainage
```

**Iron absorption**:
```
Fe³⁺ → Fe²⁺ (ferrireductase)
DMT1 (apical) → ferroportin (basolateral)
Absorption: ~1-2 mg/day (10-20% of dietary intake)
Regulated by hepcidin (blocks ferroportin)
```

**Calcium absorption**:
```
Active (duodenum): TRPV6 → calbindin → PMCA, NCX
Passive (paracellular): throughout small intestine
Absorption: ~30% of intake (higher with vitamin D)
```

**Vitamin B₁₂ absorption**:
```
B₁₂ + R-protein (saliva) → B₁₂-R complex
Pancreatic proteases release B₁₂
B₁₂ + Intrinsic Factor (IF) → B₁₂-IF complex
Cubilin receptor (terminal ileum) → endocytosis
```

### 5. GI Hormones

#### Major GI Hormones

| Hormone | Source | Main Stimuli | Main Actions |
|---------|--------|--------------|--------------|
| Gastrin | G cells (antrum) | Peptides, distension, vagus | ↑ acid secretion, ↑ growth |
| Secretin | S cells (duodenum) | H⁺ in duodenum | ↑ HCO₃⁻ secretion |
| CCK | I cells (duodenum) | Fat, amino acids | ↑ enzyme secretion, ↑ gallbladder contraction |
| GIP | K cells (duodenum) | Glucose, fat | ↑ insulin secretion (incretin) |
| GLP-1 | L cells (ileum) | Nutrients | ↑ insulin, ↓ glucagon (incretin) |
| Motilin | M cells (duodenum) | Fasting | ↑ MMC phase III |
| Somatostatin | D cells (diffuse) | Various | ↓ most GI functions |

**Gastrin dose-response**:
```
Acid secretion = A_max × [Gastrin]^n / (EC₅₀^n + [Gastrin]^n)
EC₅₀ ≈ 30-50 pg/mL
n ≈ 1-2
```

**Incretin effect**:
```
Oral glucose → 2-3× more insulin than IV glucose (same plasma glucose)
Incretin contribution: GIP (~60%) + GLP-1 (~40%)
```

**CCK satiety kinetics**:
```
Food intake inhibition ∝ log([CCK])
Half-life: ~2-3 min (rapid peptidase degradation)
```

### 6. Liver Function

#### Hepatic Blood Flow

**Total hepatic blood flow**: ~1.5 L/min (~25% of cardiac output)
```
Portal vein: ~75% (1.1 L/min)
Hepatic artery: ~25% (0.4 L/min)
```

**Hepatic extraction ratio**:
```
E = (C_in - C_out) / C_in
High extraction drugs: E > 0.7 (flow-limited)
Low extraction drugs: E < 0.3 (capacity-limited)
```

**Hepatic clearance**:
```
CL_H = Q_H × E
For high-extraction drugs: CL_H ≈ Q_H (blood flow)
```

#### Bile Acid Metabolism

**Primary bile acids**: cholic acid, chenodeoxycholic acid
**Secondary bile acids**: deoxycholic acid, lithocholic acid (bacterial modification)

**Bile acid pool kinetics**:
```
Pool size: ~2-4 g
Cycling frequency: 6-10 times/day
Daily secretion: 12-36 g
Fecal loss: 0.3-0.6 g/day (= synthesis rate)
Intestinal reabsorption: >95%
```

#### Bilirubin Metabolism

**Daily bilirubin production**: ~250-300 mg/day
```
Heme → Biliverdin → Bilirubin (unconjugated)
Unconjugated: albumin-bound, lipid soluble
Conjugated: glucuronidated in liver, water soluble
```

**Jaundice threshold**:
```
Bilirubin > 2-2.5 mg/dL (normal: 0.3-1.2 mg/dL)
```

## Computational Models

### Python Implementation

```python
import numpy as np
from scipy.integrate import odeint
from scipy.optimize import curve_fit
import matplotlib.pyplot as plt

# Physical constants
R = 8.314       # J/(mol·K)
F = 96485       # C/mol
T = 310         # K (37°C)


class GIMotility:
    """GI motility calculations"""

    @staticmethod
    def slow_wave(t, V_rest=-60, amplitude=15, frequency=0.05):
        """
        Slow wave oscillation (mV)
        frequency in Hz (0.05 Hz = 3/min for stomach)
        """
        return V_rest + amplitude * np.sin(2 * np.pi * frequency * t)

    @staticmethod
    def gastric_emptying_liquid(t, V0, k):
        """First-order gastric emptying for liquids"""
        return V0 * np.exp(-k * t)

    @staticmethod
    def gastric_emptying_solid(t, V0, t_lag, rate):
        """Lag phase + linear emptying for solids"""
        if np.isscalar(t):
            return V0 if t < t_lag else max(0, V0 - rate * (t - t_lag))
        return np.where(t < t_lag, V0, np.maximum(0, V0 - rate * (t - t_lag)))

    @staticmethod
    def transit_time(length, velocity):
        """Transit time through GI segment"""
        return length / velocity

    @staticmethod
    def MMC_period(phase_durations=[50, 40, 10]):
        """Total MMC cycle duration (minutes)"""
        return sum(phase_durations)


class GISecretion:
    """GI secretion calculations"""

    @staticmethod
    def gastric_acid_output(stim_fraction, MAO=25):
        """
        Acid output (mEq/h) based on stimulation level
        stim_fraction: 0 (basal) to 1 (maximal)
        """
        BAO = 0.15 * MAO  # ~15% of MAO at basal
        return BAO + (MAO - BAO) * stim_fraction

    @staticmethod
    def pancreatic_bicarbonate(flow_rate, max_HCO3=140, max_flow=4):
        """
        Bicarbonate concentration as function of flow
        flow_rate in mL/min
        """
        # Approaches max at high flow
        fraction = 1 - np.exp(-flow_rate / max_flow)
        return max_HCO3 * fraction + 20 * (1 - fraction)

    @staticmethod
    def salivary_flow(stimulation, basal=0.1, max_flow=4):
        """
        Salivary flow rate (mL/min)
        stimulation: 0-1 scale
        """
        return basal + (max_flow - basal) * stimulation

    @staticmethod
    def bile_acid_pool_dynamics(t, synthesis=0.4, fecal_loss_fraction=0.05, cycles_per_day=8):
        """
        Bile acid pool size over time
        synthesis: g/day
        """
        k_loss = fecal_loss_fraction * cycles_per_day  # effective loss rate
        # At steady state: synthesis = pool × k_loss
        pool_ss = synthesis / k_loss
        return pool_ss


class Digestion:
    """Digestion kinetics"""

    @staticmethod
    def enzyme_kinetics(S, Vmax, Km):
        """Michaelis-Menten enzyme kinetics"""
        return Vmax * S / (Km + S)

    @staticmethod
    def pepsin_activity(pH, optimal_pH=2.0, width=1.0):
        """pH-dependent pepsin activity (Gaussian approximation)"""
        return np.exp(-((pH - optimal_pH) / width) ** 2)

    @staticmethod
    def lipase_activity(bile_salt_conc, CMC=3):
        """
        Lipase effectiveness with bile salt concentration
        CMC: critical micellar concentration (mM)
        """
        if np.isscalar(bile_salt_conc):
            return 1.0 if bile_salt_conc > CMC else bile_salt_conc / CMC
        return np.where(bile_salt_conc > CMC, 1.0, bile_salt_conc / CMC)

    @staticmethod
    def starch_digestion(t, starch_0, k_amylase=0.1):
        """First-order starch digestion"""
        return starch_0 * np.exp(-k_amylase * t)

    @staticmethod
    def protein_digestion_cascade(t, protein_0, k_pepsin=0.05, k_pancreatic=0.2):
        """
        Two-phase protein digestion
        Stomach (pepsin) followed by pancreatic proteases
        """
        # Simplified: stomach phase then intestinal phase
        stomach_time = 3 * 60  # 3 hours in minutes
        if np.isscalar(t):
            if t < stomach_time:
                return protein_0 * np.exp(-k_pepsin * t)
            else:
                remaining = protein_0 * np.exp(-k_pepsin * stomach_time)
                return remaining * np.exp(-k_pancreatic * (t - stomach_time))

        stomach_phase = protein_0 * np.exp(-k_pepsin * np.minimum(t, stomach_time))
        intestine_start = protein_0 * np.exp(-k_pepsin * stomach_time)
        intestine_phase = intestine_start * np.exp(-k_pancreatic * np.maximum(0, t - stomach_time))
        return np.where(t < stomach_time, stomach_phase, intestine_phase)


class Absorption:
    """Nutrient and fluid absorption"""

    @staticmethod
    def SGLT1_glucose(glucose_lumen, Vmax=6, Km=0.3):
        """
        SGLT1-mediated glucose absorption (mM/min)
        Km ≈ 0.3 mM
        """
        return Vmax * glucose_lumen / (Km + glucose_lumen)

    @staticmethod
    def GLUT5_fructose(fructose_lumen, Vmax=3, Km=8):
        """
        GLUT5-mediated fructose absorption (mM/min)
        Facilitated diffusion, Km ≈ 6-11 mM
        """
        return Vmax * fructose_lumen / (Km + fructose_lumen)

    @staticmethod
    def water_absorption(Na_absorbed, osmotic_coefficient=260):
        """
        Water absorption coupled to Na⁺ transport
        ~260 H₂O per Na⁺ via SGLT1
        """
        return Na_absorbed * osmotic_coefficient

    @staticmethod
    def calcium_absorption(Ca_intake, vitamin_D_status=1.0, baseline=0.15):
        """
        Fractional calcium absorption
        vitamin_D_status: 0-1 scale
        """
        max_absorption = 0.40
        return baseline + (max_absorption - baseline) * vitamin_D_status

    @staticmethod
    def iron_absorption(Fe_intake, stores_depleted=False, hepcidin_level=1.0):
        """
        Iron absorption fraction
        stores_depleted increases absorption
        hepcidin decreases absorption
        """
        base_fraction = 0.10
        if stores_depleted:
            base_fraction = 0.25
        return base_fraction / hepcidin_level

    @staticmethod
    def fat_absorption_efficiency(bile_salt_conc, CMC=3, lipase_activity=1.0):
        """Fat absorption efficiency (fraction)"""
        if bile_salt_conc < CMC:
            micellar_efficiency = bile_salt_conc / CMC
        else:
            micellar_efficiency = 1.0
        return 0.95 * micellar_efficiency * lipase_activity


class GIHormones:
    """GI hormone secretion and effects"""

    @staticmethod
    def gastrin_acid_response(gastrin_pg_mL, Amax=25, EC50=40, n=1.5):
        """
        Acid secretion response to gastrin
        gastrin_pg_mL: plasma gastrin concentration
        """
        return Amax * gastrin_pg_mL**n / (EC50**n + gastrin_pg_mL**n)

    @staticmethod
    def secretin_bicarbonate(pH_duodenum, threshold=4.5, max_response=140):
        """
        Secretin release based on duodenal pH
        Released when pH < 4.5
        """
        if np.isscalar(pH_duodenum):
            if pH_duodenum > threshold:
                return 0
            return max_response * (threshold - pH_duodenum) / threshold
        return np.where(pH_duodenum > threshold, 0,
                       max_response * (threshold - pH_duodenum) / threshold)

    @staticmethod
    def CCK_response(fat_g, aa_g, EC50_fat=5, EC50_aa=10):
        """CCK release based on fat and amino acid content"""
        fat_signal = fat_g / (EC50_fat + fat_g)
        aa_signal = aa_g / (EC50_aa + aa_g)
        return fat_signal + aa_signal  # Additive effects

    @staticmethod
    def incretin_effect(glucose_oral, glucose_iv):
        """
        Incretin effect: ratio of insulin response
        Normally ~2-3× higher for oral glucose
        """
        return glucose_oral / glucose_iv if glucose_iv > 0 else float('inf')

    @staticmethod
    def GLP1_insulin_response(GLP1_pM, glucose_mM, EC50_GLP1=10, glucose_threshold=5):
        """
        GLP-1 potentiation of insulin secretion
        Only effective above glucose threshold
        """
        glucose_factor = max(0, (glucose_mM - glucose_threshold) / glucose_threshold)
        GLP1_effect = GLP1_pM / (EC50_GLP1 + GLP1_pM)
        return glucose_factor * GLP1_effect


class LiverFunction:
    """Hepatic function calculations"""

    @staticmethod
    def hepatic_blood_flow(portal=1.1, arterial=0.4):
        """Total hepatic blood flow (L/min)"""
        return portal + arterial

    @staticmethod
    def extraction_ratio(C_in, C_out):
        """Hepatic extraction ratio"""
        return (C_in - C_out) / C_in if C_in > 0 else 0

    @staticmethod
    def hepatic_clearance(Q_H, E):
        """
        Hepatic clearance (L/min)
        Q_H: hepatic blood flow
        E: extraction ratio
        """
        return Q_H * E

    @staticmethod
    def first_pass_effect(E):
        """Bioavailability after first pass"""
        return 1 - E

    @staticmethod
    def bilirubin_production(Hb_turnover_g=6, conversion_factor=35):
        """
        Daily bilirubin production (mg)
        ~35 mg bilirubin per gram Hb
        """
        return Hb_turnover_g * conversion_factor

    @staticmethod
    def lithogenic_index(cholesterol, bile_acids, phospholipids):
        """
        Lithogenic index for gallstone risk
        > 1 indicates supersaturation
        """
        # Simplified formula
        max_cholesterol = 0.07 * bile_acids + 0.26 * phospholipids
        return cholesterol / max_cholesterol if max_cholesterol > 0 else float('inf')


class GIModel:
    """Integrated GI tract model"""

    def __init__(self):
        self.motility = GIMotility()
        self.secretion = GISecretion()
        self.digestion = Digestion()
        self.absorption = Absorption()
        self.hormones = GIHormones()
        self.liver = LiverFunction()

    def meal_response(self, meal_composition, duration_hours=8):
        """
        Simulate response to a meal
        meal_composition: dict with 'carbs', 'protein', 'fat' in grams
        """
        t = np.linspace(0, duration_hours * 60, 1000)  # minutes

        carbs = meal_composition.get('carbs', 50)
        protein = meal_composition.get('protein', 25)
        fat = meal_composition.get('fat', 20)

        # Gastric emptying (solid)
        stomach_content = self.motility.gastric_emptying_solid(
            t, V0=carbs + protein + fat, t_lag=30, rate=1.5
        )

        # Digestion (simplified)
        carb_remaining = self.digestion.starch_digestion(t, carbs, k_amylase=0.02)

        return {
            'time': t,
            'stomach_content': stomach_content,
            'carb_remaining': carb_remaining
        }

    def fluid_balance(self):
        """Daily GI fluid balance"""
        input_sources = {
            'ingested': 2.0,
            'salivary': 1.5,
            'gastric': 2.5,
            'bile': 0.5,
            'pancreatic': 1.5,
            'intestinal': 1.0
        }

        total_input = sum(input_sources.values())

        absorption = {
            'small_intestine': 7.5,
            'colon': 1.35
        }

        fecal_output = total_input - sum(absorption.values())

        return {
            'input': input_sources,
            'total_input_L': total_input,
            'absorption': absorption,
            'fecal_output_mL': fecal_output * 1000
        }


# Example usage and visualization
if __name__ == "__main__":
    model = GIModel()

    # Simulate meal response
    meal = {'carbs': 75, 'protein': 30, 'fat': 25}
    response = model.meal_response(meal)

    # Plot gastric emptying
    plt.figure(figsize=(12, 8))

    plt.subplot(2, 2, 1)
    plt.plot(response['time'], response['stomach_content'], 'b-', linewidth=2)
    plt.xlabel('Time (min)')
    plt.ylabel('Stomach Content (g)')
    plt.title('Gastric Emptying')
    plt.grid(True)

    # Plot slow waves
    plt.subplot(2, 2, 2)
    t_wave = np.linspace(0, 120, 1000)  # 2 minutes in seconds
    stomach_wave = GIMotility.slow_wave(t_wave, frequency=0.05)
    duodenum_wave = GIMotility.slow_wave(t_wave, frequency=0.2)
    plt.plot(t_wave, stomach_wave, 'r-', label='Stomach (3/min)')
    plt.plot(t_wave, duodenum_wave, 'b-', label='Duodenum (12/min)')
    plt.xlabel('Time (s)')
    plt.ylabel('Membrane Potential (mV)')
    plt.title('GI Slow Waves')
    plt.legend()
    plt.grid(True)

    # Plot enzyme kinetics
    plt.subplot(2, 2, 3)
    substrate = np.linspace(0, 50, 100)
    rate = Digestion.enzyme_kinetics(substrate, Vmax=10, Km=5)
    plt.plot(substrate, rate, 'g-', linewidth=2)
    plt.axhline(y=5, color='r', linestyle='--', label='Vmax/2')
    plt.axvline(x=5, color='r', linestyle='--', label='Km')
    plt.xlabel('Substrate Concentration')
    plt.ylabel('Reaction Rate')
    plt.title('Enzyme Kinetics (Michaelis-Menten)')
    plt.legend()
    plt.grid(True)

    # Plot hormone response
    plt.subplot(2, 2, 4)
    gastrin = np.linspace(0, 200, 100)
    acid = GIHormones.gastrin_acid_response(gastrin)
    plt.plot(gastrin, acid, 'm-', linewidth=2)
    plt.xlabel('Plasma Gastrin (pg/mL)')
    plt.ylabel('Acid Output (mEq/h)')
    plt.title('Gastrin-Acid Secretion Response')
    plt.grid(True)

    plt.tight_layout()
    plt.savefig('gi_physiology.png', dpi=150)

    # Print fluid balance
    print("\nDaily GI Fluid Balance:")
    balance = model.fluid_balance()
    print(f"  Total input: {balance['total_input_L']:.1f} L")
    print(f"  Fecal output: {balance['fecal_output_mL']:.0f} mL")
```

### Julia Implementation

```julia
using DifferentialEquations
using Plots

# Constants
const R = 8.314       # J/(mol·K)
const F = 96485       # C/mol
const T_body = 310    # K

module GIMotility
    """GI motility functions"""

    function slow_wave(t; V_rest=-60.0, amplitude=15.0, frequency=0.05)
        V_rest + amplitude * sin(2π * frequency * t)
    end

    function gastric_emptying_liquid(t, V0, k)
        V0 * exp(-k * t)
    end

    function gastric_emptying_solid(t, V0, t_lag, rate)
        t < t_lag ? V0 : max(0, V0 - rate * (t - t_lag))
    end

    function transit_time(length, velocity)
        length / velocity
    end
end

module GISecretion
    """GI secretion functions"""

    function gastric_acid_output(stim_fraction; MAO=25.0)
        BAO = 0.15 * MAO
        BAO + (MAO - BAO) * stim_fraction
    end

    function pancreatic_bicarbonate(flow_rate; max_HCO3=140.0, max_flow=4.0)
        fraction = 1 - exp(-flow_rate / max_flow)
        max_HCO3 * fraction + 20 * (1 - fraction)
    end

    function salivary_flow(stimulation; basal=0.1, max_flow=4.0)
        basal + (max_flow - basal) * stimulation
    end
end

module Digestion
    """Digestion kinetics"""

    function enzyme_kinetics(S, Vmax, Km)
        Vmax * S / (Km + S)
    end

    function pepsin_activity(pH; optimal_pH=2.0, width=1.0)
        exp(-((pH - optimal_pH) / width)^2)
    end

    function starch_digestion(t, starch_0; k_amylase=0.1)
        starch_0 * exp(-k_amylase * t)
    end

    function lipase_activity(bile_salt_conc; CMC=3.0)
        bile_salt_conc > CMC ? 1.0 : bile_salt_conc / CMC
    end
end

module Absorption
    """Nutrient absorption"""

    function SGLT1_glucose(glucose_lumen; Vmax=6.0, Km=0.3)
        Vmax * glucose_lumen / (Km + glucose_lumen)
    end

    function GLUT5_fructose(fructose_lumen; Vmax=3.0, Km=8.0)
        Vmax * fructose_lumen / (Km + fructose_lumen)
    end

    function calcium_absorption(Ca_intake; vitamin_D_status=1.0, baseline=0.15)
        max_absorption = 0.40
        baseline + (max_absorption - baseline) * vitamin_D_status
    end

    function iron_absorption(Fe_intake; stores_depleted=false, hepcidin_level=1.0)
        base_fraction = stores_depleted ? 0.25 : 0.10
        base_fraction / hepcidin_level
    end

    function fat_absorption_efficiency(bile_salt_conc; CMC=3.0, lipase_activity=1.0)
        micellar = bile_salt_conc > CMC ? 1.0 : bile_salt_conc / CMC
        0.95 * micellar * lipase_activity
    end
end

module GIHormones
    """GI hormone functions"""

    function gastrin_acid_response(gastrin_pg_mL; Amax=25.0, EC50=40.0, n=1.5)
        Amax * gastrin_pg_mL^n / (EC50^n + gastrin_pg_mL^n)
    end

    function secretin_bicarbonate(pH_duodenum; threshold=4.5, max_response=140.0)
        pH_duodenum > threshold ? 0.0 : max_response * (threshold - pH_duodenum) / threshold
    end

    function CCK_response(fat_g, aa_g; EC50_fat=5.0, EC50_aa=10.0)
        fat_g / (EC50_fat + fat_g) + aa_g / (EC50_aa + aa_g)
    end

    function GLP1_insulin_response(GLP1_pM, glucose_mM; EC50_GLP1=10.0, glucose_threshold=5.0)
        glucose_factor = max(0, (glucose_mM - glucose_threshold) / glucose_threshold)
        GLP1_effect = GLP1_pM / (EC50_GLP1 + GLP1_pM)
        glucose_factor * GLP1_effect
    end
end

module LiverFunction
    """Hepatic functions"""

    function hepatic_blood_flow(; portal=1.1, arterial=0.4)
        portal + arterial
    end

    function extraction_ratio(C_in, C_out)
        C_in > 0 ? (C_in - C_out) / C_in : 0.0
    end

    function hepatic_clearance(Q_H, E)
        Q_H * E
    end

    function first_pass_effect(E)
        1 - E
    end

    function bilirubin_production(; Hb_turnover_g=6.0, conversion_factor=35.0)
        Hb_turnover_g * conversion_factor
    end

    function lithogenic_index(cholesterol, bile_acids, phospholipids)
        max_chol = 0.07 * bile_acids + 0.26 * phospholipids
        max_chol > 0 ? cholesterol / max_chol : Inf
    end
end

"""
GI tract ODE model for nutrient digestion and absorption

State variables:
u[1] = stomach content (g)
u[2] = small intestine content (g)
u[3] = absorbed nutrients (g)
"""
function gi_tract!(du, u, p, t)
    stomach, intestine, absorbed = u
    k_empty, k_digest, k_absorb = p

    # Gastric emptying (first-order)
    emptying_rate = k_empty * stomach

    # Intestinal digestion
    digestion_rate = k_digest * intestine

    # Absorption (Michaelis-Menten-like)
    Vmax_abs = k_absorb
    Km_abs = 10.0
    absorption_rate = Vmax_abs * intestine / (Km_abs + intestine)

    du[1] = -emptying_rate                          # dstomach/dt
    du[2] = emptying_rate - absorption_rate         # dintestine/dt
    du[3] = absorption_rate                         # dabsorbed/dt
end

"""
Simulate meal digestion and absorption
"""
function simulate_meal(meal_mass; duration_hours=8)
    u0 = [meal_mass, 0.0, 0.0]  # All in stomach initially

    # Parameters: emptying rate, digestion rate, absorption rate
    p = (0.02, 0.1, 5.0)  # per minute

    tspan = (0.0, duration_hours * 60)  # minutes

    prob = ODEProblem(gi_tract!, u0, tspan, p)
    sol = solve(prob, Tsit5(), saveat=1.0)

    return sol
end

# Example: simulate and plot
function run_gi_example()
    sol = simulate_meal(100.0)  # 100g meal

    plt = plot(sol.t / 60, sol[1, :],
               label="Stomach", linewidth=2,
               xlabel="Time (hours)", ylabel="Content (g)",
               title="Meal Digestion and Absorption")
    plot!(plt, sol.t / 60, sol[2, :], label="Small Intestine", linewidth=2)
    plot!(plt, sol.t / 60, sol[3, :], label="Absorbed", linewidth=2)

    return plt
end
```

## Problem-Solving Approach

### Step-by-Step Method

1. **Identify the process**: Motility, secretion, digestion, or absorption?
2. **Determine the segment**: Mouth, esophagus, stomach, small/large intestine, liver?
3. **List relevant parameters** with physiological values
4. **Select appropriate equation** (kinetic, transport, or regulatory)
5. **Calculate and validate** against normal ranges
6. **Consider regulation**: What hormones/neural inputs modulate this?

### Typical Problems

**Type 1: Motility/Transit**
- Given: Segment length, contraction frequency
- Find: Transit time, propagation velocity

**Type 2: Secretion**
- Given: Stimulation level, basal rates
- Find: Secretion volume, composition

**Type 3: Digestion**
- Given: Substrate amount, enzyme parameters
- Find: Digestion rate, products formed

**Type 4: Absorption**
- Given: Luminal concentrations, transporter kinetics
- Find: Absorption rate, total absorbed

**Type 5: Hormonal regulation**
- Given: Nutrient stimulus, hormone levels
- Find: Downstream effects on secretion/motility

## Clinical Correlations

| Condition | Mechanism | Key Finding |
|-----------|-----------|-------------|
| GERD | ↓ LES pressure, hiatal hernia | pH < 4 in esophagus |
| Peptic ulcer | H. pylori, NSAIDs, ↑ acid | Mucosal erosion |
| Celiac disease | Gluten → villous atrophy | ↓ absorption, ↑ stool fat |
| Lactose intolerance | ↓ lactase activity | Osmotic diarrhea |
| Chronic pancreatitis | ↓ enzyme secretion | Malabsorption, steatorrhea |
| Gallstones | Supersaturated bile | LI > 1 |
| Cirrhosis | ↓ hepatic function | ↑ bilirubin, ↓ albumin |
| Gastroparesis | Delayed emptying | t½ > 90 min (solids) |
| Dumping syndrome | Rapid emptying | Hypoglycemia post-meal |
| Short bowel syndrome | ↓ absorptive surface | Malabsorption, diarrhea |

## Key Relationships Summary

| Process | Driving Force | Rate Equation |
|---------|---------------|---------------|
| Gastric emptying | Pressure gradient | dV/dt = -k×V (liquids) |
| Enzyme digestion | Substrate concentration | J = Jmax×S/(Km+S) |
| Nutrient absorption | Concentration gradient | J = Jmax×C/(Km+C) |
| Hormone release | Nutrient stimulus | Response = f(stimulus) |
| Bile acid cycling | Enterohepatic circulation | Pool × cycles/day |
